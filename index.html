<!DOCTYPE html>
<html>
<head>
    <title>Building a Microservices Architecture with CI/CD Using Docker, Jenkins, and SonarQube</title>
</head>
<body>

<h1>Building a Microservices Architecture with CI/CD Using Docker, Jenkins, and SonarQube</h1>

<h2>Introduction</h2>
<p>This article provides a comprehensive guide to create a robust microservices architecture with a Continuous Integration/Continuous Deployment (CI/CD) pipeline using Docker, Jenkins, and SonarQube. By the end, you'll have access to the GitHub repository for this project.</p>

<h2>Prerequisites</h2>
<p>Before diving in, make sure you have basic knowledge of Linux (Ubuntu), Docker, and Jenkins. You should also have an Ubuntu Server at your disposal with Docker, Docker Compose, and Jenkins installed.</p>

<h2>Step-by-Step Guide</h2>

<h3>Initial Server Setup</h3>
<p>Begin by setting up your Ubuntu Server:</p>
<ul>
    <li>Update packages:
        <pre><code>sudo apt update</code></pre>
    </li>
    <li>Install Java for Jenkins:
        <pre><code>sudo apt install openjdk-11-jdk -y</code></pre>
    </li>
    <li>Install Docker and Docker Compose:
        <pre><code># Docker
sudo apt install apt-transport-https ca-certificates curl software-properties-common -y
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
sudo apt update
sudo apt install docker-ce -y

# Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose</code></pre>
    </li>
    <li>Install Node.js, NPM, and Git:
        <pre><code>sudo apt install nodejs npm git -y</code></pre>
    </li>
</ul>

<h2>Diagram of the Project</h2>
<p>Insert your diagram here.</p>


<h3>Jenkins Installation and Configuration</h3>
<p>After preparing your Ubuntu server with the initial setup, proceed with the Jenkins installation and configuration as follows:</p>
  <p>Update your package manager:</p>
  <pre><code>sudo apt update</code></pre>
  <p>Install Java (Jenkins requires Java to run):</p>
  <pre><code>sudo apt install openjdk-11-jdk -y</code></pre>
  <p>Add the Jenkins repository and key:</p>
  <pre><code>wget -q -O - https://pkg.jenkins.io/debian/jenkins.io.key | sudo apt-key add -
echo "deb https://pkg.jenkins.io/debian-stable binary/" | sudo tee /etc/apt/sources.list.d/jenkins.list</code></pre>
  <p>Install Jenkins:</p>
  <pre><code>sudo apt update
sudo apt install jenkins -y</code></pre>
  <p>Start Jenkins:</p>
  <pre><code>sudo systemctl start jenkins</code></pre>
  <p>Enable Jenkins to run at boot:</p>
  <pre><code>sudo systemctl enable jenkins</code></pre>
  <p>After completing these steps, Jenkins will be installed and running on your server. You can access it by navigating to http://your_server_ip_or_domain:8080. The initial setup will guide you through unlocking Jenkins with an automatically generated admin password, located in /var/lib/jenkins/secrets/initialAdminPassword, and through the installation of recommended plugins.</p>
  <p>Next, proceed to install the required Jenkins Plugins for Docker, SonarQube Scanner, and Pipeline support as previously outlined. This will ensure your Jenkins instance is ready to handle the CI/CD pipeline for your microservices architecture.</p>
  <p>Add Jenkins repository and install Jenkins. Access it at http://your_server_ip_or_domain:8080 and complete the setup.</p>

  <h2>Create and Login to SonarQube</h2>
  <p>Run SonarQube as a Docker container:</p>
  <pre><code>sudo docker run -d --name sonarqube -p 9000:9000 sonarqube</code></pre>
  <p>Access SonarQube at <em>http://your_server_ip_or_domain:9000</em>. The default credentials are:</p>
  <ul>
      <li>Username: admin</li>
      <li>Password: admin</li>
  </ul>
  <p>Once logged in, click on "Administration" in the top right corner. Under the "Projects" section, click on "Management." Click on the "+" icon to create a new project. Provide a unique project key and display name. Click "Create."</p>

  <h2>Step 5: Generate an Authentication Token</h2>
  <p>Go to "Administration" &gt; "Security" &gt; "Users." Select your user (admin) or create a new one. Navigate to the "Tokens" tab. Click on "Generate Tokens." Provide a name for the token (e.g., Jenkins Token).</p>

  <h2>1. Install Required Plugins</h2>
  <p>To enhance your Jenkins setup with Docker, Docker Compose, NPM, Git, email notifications, and monitoring capabilities, follow these steps:</p>
  <ol>
      <li>Go to Jenkins Dashboard: Navigate through Manage Jenkins → Manage Plugins.</li>
      <li>Install Plugins: In the "Available" tab, search and install the following plugins if they're not already installed:
          <ul>
              <li>Docker Pipeline (for Docker support)</li>
              <li>CloudBees Docker Build and Publish (for Docker image handling)</li>
              <li>Pipeline: NPM (for NPM support)</li>
              <li>Git plugin (for Git support)</li>
              <li>Email Extension Plugin (for enhanced email notifications)</li>
              <li>Build Monitor View (for creating a monitoring dashboard)</li>
              <li>Any other plugins you find necessary for your setup (e.g., NodeJS plugin for managing Node versions).</li>
          </ul>
      </li>
  </ol>

  <h2>2. Configure Tools and Plugins</h2>
  <p>Docker and Docker Compose: Ensure Docker is installed on your Jenkins agent or server. For Docker Compose, you might need to install it separately on the agent.</p>
  <p>To use the downloaded plugin we need to go to Manage Jenkins → Global Tool Configuration. and configure the the plugins</p>
  <p>Git: Configure Git under Global Tool Configuration if needed, ensuring Jenkins can access your repositories.</p>
  <p>Email Notifications: Configure email notifications under Manage Jenkins → Configure System → Extended E-mail Notification. Set SMTP server, user credentials, and other settings as required.</p>
  <p>Monitoring View: After installing the Build Monitor View plugin, create a new view by clicking on "+ New View" on the Jenkins dashboard. Select "Build Monitor View" and configure it to display your jobs' status.</p>

  <h2>3. Setting Up SonarQube Scanner</h2>
  <p>In addition to the SonarQube plugin installation, ensure the SonarQube Scanner is set up:</p>
  <ul>
      <li>Navigate to Manage Jenkins → Global Tool Configuration.</li>
      <li>Find the SonarQube Scanner section and configure it with the path to the SonarScanner or automatically install it.</li>
      <li>We will need to tell Jenkins where to find the SonarQube server, which can be done by following these steps:
        <ol>
          <li>Go to Jenkins > Manage Jenkins > Configure System.</li>
          <li>Scroll down to the "SonarQube servers" section.</li>
          <li>Click on "Add SonarQube" to add a new server.</li>
          <li>Provide a name (e.g., "SonarQube Server").</li>
        </li>

  </ul>

  <h4>Creating the CI/CD Pipeline with Jenkins</h4>
  <p>Create a New Pipeline Job: Select "Pipeline" and configure with the provided Jenkinsfile code.</p>
  <p>Define Environment Variables: Such as GIT_CREDENTIAL_ID, DOCKERHUB_CREDENTIAL_ID.</p>
  <p>To save your credentials in Jenkins, follow these steps: Add the generated token to Jenkins credentials with any ID.</p>
  <ol>
    <li>Manage Jenkins → Credentials → System → Global credentials (unrestricted) → Add Credentials.</li>
    <li>Pipeline Stages: Outline steps for checkout, build, test, deploy, and analyze phases.</li>
  </ol>

  <h2>Additional Steps for Project Setup and Maintenance</h2>
  <ul>
      <li>Manage Jenkins Credentials: Store all necessary credentials like GitHub, DockerHub, and SonarQube tokens securely in Jenkins. Go to Manage Jenkins → Manage Credentials → System → Global credentials → Add Credentials.</li>
      <li>Pipeline Script: Ensure your Jenkinsfile includes steps for Docker/Docker Compose tasks, NPM installations, Git checkout, and email notifications post-build.</li>
      <li>Email Notification Configuration in Jenkinsfile: Store Credentials for GitHub and DockerHub in Jenkins for secure access.</li>
  </ul>
  
  <h4>Accessing the Application</h4>
  <p>Access the services through the Nginx reverse proxy by navigating to your domain or public IP:</p>
  <ul>
    <li>/auth/ routes to the auth-service.</li>
    <li>/users/ routes to the user-service.</li>
    <li>/products/ routes to the product-service.</li>
  </ul>

<h2>Conclusion</h2>
<p>This step-by-step guide covers the creation of a microservices architecture with an integrated CI/CD pipeline using Docker, Jenkins, and SonarQube. For in-depth details and access to the complete setup, refer to the GitHub repository shared at the end of this article. This approach empowers developers to replicate or adapt this architecture for their own projects while ensuring a deeper understanding of each component's role.</p>

<h2>GitHub Project Page</h2>
<p>Access the complete setup and source code on GitHub: <a href="https://github.com/sabayneh1/docker-Distributed-System-with-Microservices-Architecture.git">GitHub Repository</a>.</p>

</body>
</html>
